version: '3.8'

services:
  cortex-core:
    build: .
    image: gamesa/cortex-v2:latest
    container_name: gamesa_cortex_v2
    restart: always

    # Enable Hardware Passthrough for GPU/NPU
    devices:
      - /dev/dri:/dev/dri # Intel/AMD GPU
      # - /dev/kfd:/dev/kfd # AMD ROCm (Uncomment if needed)

      # For NVIDIA support (requires nvidia-container-toolkit)
      # deploy:
      #   resources:
      #     reservations:
      #       devices:
      #         - driver: nvidia
      #           count: 1
      #           capabilities: [gpu]

    volumes:
      - .:/app # Mount current dir for live reload/code access

    environment:
      - PYTHONUNBUFFERED=1
      - VULKAN_SDK_PATH=/usr
      - OPENCL_VENDOR_PATH=/etc/OpenCL/vendors

    # Security privileges for hardware access (Optional but often needed for raw device access)
    privileged: true
  # Future Services
  # redis:
  #   image: redis:alpine
  #   ports: ["6379:6379"]
